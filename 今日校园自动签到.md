# 今日校园自动签到

**非科班出身，代码有不规范的地方请见谅**

## 一、背景

自从疫情后，我们学校每天都要今日校园签到，而我经常忘记，定了闹钟都经常忙完手上的事转眼就给忘了，是忘签到名单上的常客，准备写一个程序，让他自动签个到

## 二、准备环境

下载一个`python`环境

点击[进入官网](https://www.python.org/downloads/)

**推荐使用3.7或3.8版本**，项目使用3.7版本

## 三、简述思路

>1. **首先我们要搞明白今日校园签到你的手机会发出什么请求**
>2. **然后我们对这个请求进行一个模拟**
>3. **最后我们要想个办法让这个程序每天自动运行**

## 四、实现

### 1.对今日校园进行抓包

非常难受, 安卓手机证书太坑了

### 2.写代码

创建一个`Data.json`文件用于存放配置数据

#### 1.配置日志文件

新建文件`logger.conf`

```
#logger.conf

###############################################

[loggers]
keys=root,jrxy

[logger_root]
level=DEBUG
handlers=stream

[logger_jrxy]
handlers=stream,timedrt,http
qualname=jrxy
propagate=0

###############################################

[handlers]
keys=stream,timedrt,http

[handler_stream]
class=StreamHandler
level=NOTSET
formatter=form01
args=(sys.stderr,)

[handler_filert]
class=handlers.RotatingFileHandler
level=INFO
formatter=form02
args=('log/jrxy.log', 'a', 10*1024*1024, 5)

[handler_timedrt]
class=handlers.TimedRotatingFileHandler
level=DEBUG
formatter=form01
args=('log/jrxy.log', 'd', 1 , 5 )

[handler_http]
class=handlers.HTTPHandler
level=ERROR
formatter=form01
args=('localhost:8087', '/api/v1.0/log', 'POST')


###############################################

[formatters]
keys=form01,form02

[formatter_form01]
format=[%(asctime)s][%(filename)s][line:%(lineno)d][%(levelname)s] %(message)s
datefmt=%a, %d %b %Y %H:%M:%S

[formatter_form02]
format=%(name)-12s: %(levelname)-8s %(message)s
datefmt=
```

新建`config.py`

```python
import logging
from logging import config

logging.config.fileConfig("logger.conf")
logger = logging.getLogger("jrxy")
```

新建文件夹`log`,在log文件夹中新建文件`jrxy.log`

#### 2.获取学校ID

新建`getSchoolId.py`文件

```python
def getJson(url):
    try:
        r = requests.get(url, timeout=5)
        r.encoding = r.apparent_encoding
        return r.json()['data']
    except:
        raise

def cleanData(data: dict, school_list: list):
    pass
```

***这里不贴出具体实现，拿到数据了，从数据中找到学校ID应该不难。***

#### 3.获取登录的地址

登录地址不好搞啊，目前仅支持`大连大学`, 会搞的可以自己改改

新建`getSchoolLoginUrl.py`文件

```python
def get_schoollist(url):
    pass


def get_url(data: dict, school_id: str):
	pass
```

**第二步可以省略，我当时是写都写了就直接用id了，会改的微改一下第三步的代码即可**

#### 4模拟登录

登录非常麻烦，有非常多的验证，验证虽然多，但还好的是过了验证就成功一半了😁

***==加油上学人！！！==***



```python
# 获取secretkey
# url = "https://mobile.campushoy.com/app/auth/dynamic/secret/getSecretKey/v-9014"
```
